"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Validator_1 = global[Symbol.for('ioc.use')]("Adonis/Core/Validator");
const Prisma_1 = global[Symbol.for('ioc.use')]("Adonis/Addons/Prisma");
const Logger_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Core/Logger"));
class NotasController {
    async store({ request, response }) {
        try {
            const validationSchema = Validator_1.schema.create({
                notaExamen: Validator_1.schema.number(),
                notaTrabajos: Validator_1.schema.number(),
                notaParticipacion: Validator_1.schema.number(),
                notaAsistencia: Validator_1.schema.number(),
                notaOPI: Validator_1.schema.number(),
                estudianteId: Validator_1.schema.string(),
                libroId: Validator_1.schema.string(),
                filialId: Validator_1.schema.string(),
            });
            const payload = await request.validate({
                schema: validationSchema,
            });
            const existingNota = await Prisma_1.prisma.nota.findFirst({
                where: {
                    libroId: payload.libroId,
                },
            });
            if (existingNota) {
                return response.badRequest({ message: 'Ya existe una nota para este libro' });
            }
            const notaTrabajosWeight = 0.5;
            const notaParticipacionWeight = 0.1;
            const notaAsistenciaWeight = 0.1;
            const notaOPIWeight = 0.3;
            const promedio = (payload.notaTrabajos * notaTrabajosWeight +
                payload.notaParticipacion * notaParticipacionWeight +
                payload.notaAsistencia * notaAsistenciaWeight +
                payload.notaOPI * notaOPIWeight);
            const nuevaNota = await Prisma_1.prisma.nota.create({
                data: {
                    notaExamen: 0,
                    notaTrabajos: payload.notaTrabajos,
                    notaParticipacion: payload.notaParticipacion,
                    notaAsistencia: payload.notaAsistencia,
                    notaOPI: payload.notaOPI,
                    notaParcial: promedio,
                    notaRetest: 0,
                    promedioFinal: 0,
                    estudianteId: payload.estudianteId,
                    libroId: payload.libroId,
                    filialId: payload.filialId,
                },
            });
            Logger_1.default.info('Nueva nota creada con éxito', { notaId: nuevaNota.id });
            return response.status(201).json(nuevaNota);
        }
        catch (error) {
            Logger_1.default.error('Error al crear la nota', error);
            return response.badRequest({ message: 'Error al crear la nota' });
        }
    }
    async options({ request, response }) {
        try {
            const updateNotaSchema = Validator_1.schema.create({
                notaExamen: Validator_1.schema.number.optional(),
                notaParcial: Validator_1.schema.number.optional(),
                notaRetest: Validator_1.schema.number.optional(),
                notaId: Validator_1.schema.string(),
            });
            const { notaExamen, notaRetest, notaId } = await request.validate({
                schema: updateNotaSchema,
            });
            if (notaExamen < 0 || notaRetest < 0) {
                return response.badRequest({ message: 'La nota mínima debe ser 0' });
            }
            await Prisma_1.prisma.$transaction(async (prisma) => {
                const existingNota = await prisma.nota.findUnique({
                    where: { id: notaId },
                });
                if (!existingNota) {
                    return response.badRequest({ message: 'No se encontró una nota con este ID' });
                }
                const notaParcial = existingNota.notaParcial;
                let promedioFinal = (notaExamen * 0.9) + (notaParcial * 0.1);
                if (notaRetest > 75) {
                    promedioFinal = notaRetest;
                }
                const nuevaNota = await prisma.nota.update({
                    where: { id: notaId },
                    data: {
                        notaExamen: notaExamen,
                        notaRetest: notaRetest,
                        promedioFinal: promedioFinal,
                    },
                });
                Logger_1.default.info('Valores actualizados con éxito', { notaId: nuevaNota.id });
                return response.status(200).json({ message: 'Valores actualizados con éxito' });
            });
        }
        catch (error) {
            Logger_1.default.error('Error al actualizar los valores', error);
            return response.badRequest({ message: 'Error al actualizar los valores' });
        }
    }
    async showLibro({ params, response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany({
                where: {
                    libroId: params.id,
                },
                include: {
                    estudiante: true,
                    libro: true,
                    filial: true,
                },
            });
            return response.status(200).json(notas);
        }
        catch (error) {
            Logger_1.default.error('Error al buscar notas por ID de libro', error);
            return response.badRequest({ message: 'Error al buscar notas por ID de libro' });
        }
    }
    async showFilialS({ params, response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany({
                where: {
                    filialId: params.id,
                },
                include: {
                    estudiante: true,
                    libro: true,
                    filial: true,
                },
            });
            return response.status(200).json(notas);
        }
        catch (error) {
            Logger_1.default.error('Error al buscar notas por ID de filial T', error);
            return response.badRequest({ message: 'Error al buscar notas por ID de filial' });
        }
    }
    async showFilialBIEN({ params, response }) {
        try {
            const { libroId } = params;
            const notas = await Prisma_1.prisma.nota.findMany({
                where: { libroId },
            });
            if (notas.length === 0) {
                return response.notFound({ message: 'No se encontraron notas para este libroId' });
            }
            return response.status(200).json(notas);
        }
        catch (error) {
            Logger_1.default.error('Error al filtrar las notas por libroId', error);
            return response.badRequest({ message: 'Error al filtrar las notas por libroId' });
        }
    }
    async showFilial({ params, response }) {
        try {
            const estudianteId = params.estudianteId;
            const libroId = params.libroId;
            const notas = await Prisma_1.prisma.nota.findMany({
                where: {
                    estudianteId: estudianteId,
                    libroId: libroId
                },
            });
            if (notas.length === 0) {
                return response.status(404).json({ message: 'No se encontraron notas para este estudianteId' });
            }
            return response.status(200).json(notas);
        }
        catch (error) {
            Logger_1.default.error('Error al buscar notas por estudianteId', error);
            return response.badRequest({ message: 'Error al buscar notas por estudianteId' });
        }
    }
    async showEstu({ request, response }) {
        try {
            const { nombre, matricula } = request.qs();
            if (!nombre && !matricula) {
                return response.badRequest({ message: 'Debes proporcionar al menos el nombre o la matrícula del estudiante.' });
            }
            const notas = await Prisma_1.prisma.nota.findMany({
                where: {
                    OR: [
                        {
                            estudiante: {
                                nombre: nombre,
                            },
                        },
                        {
                            estudiante: {
                                matricula: matricula,
                            },
                        },
                    ],
                },
                include: {
                    estudiante: true,
                    libro: true,
                    filial: true,
                },
            });
            return response.status(200).json(notas);
        }
        catch (error) {
            Logger_1.default.error('Error al buscar notas por nombre o matrícula del estudiante', error);
            return response.badRequest({ message: 'Error al buscar notas por nombre o matrícula del estudiante' });
        }
    }
    async getNotas({ response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany();
            const notasConNombres = await Promise.all(notas.map(async (nota) => {
                const estudiante = await Prisma_1.prisma.persona.findUnique({
                    where: { id: nota.estudianteId },
                });
                const libro = await Prisma_1.prisma.libro.findUnique({
                    where: { id: nota.libroId },
                });
                return {
                    ...nota,
                    nombreEstudiante: estudiante?.nombre,
                    ApellidosP: estudiante?.apellidoPaterno,
                    ApellidosM: estudiante?.apellidoMaterno,
                    nombreLibro: libro?.nombre,
                };
            }));
            return response.ok(notasConNombres);
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener las notas' });
        }
    }
    async getNotasPorLibroID({ params, response }) {
        try {
            const libroId = params.libroId;
            const notas = await Prisma_1.prisma.nota.findMany({
                where: {
                    libroId: libroId,
                },
            });
            const notasConNombres = await Promise.all(notas.map(async (nota) => {
                const estudiante = await Prisma_1.prisma.persona.findUnique({
                    where: { id: nota.estudianteId },
                });
                const libro = await Prisma_1.prisma.libro.findUnique({
                    where: { id: nota.libroId },
                });
                return {
                    ...nota,
                    nombreEstudiante: estudiante?.nombre,
                    ApellidosP: estudiante?.apellidoPaterno,
                    ApellidosM: estudiante?.apellidoMaterno,
                    nombreLibro: libro?.nombre,
                };
            }));
            return response.ok(notasConNombres);
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener las notas' });
        }
    }
    async getNotasP({ response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany();
            const promediosEstudiantes = {};
            notas.forEach((nota) => {
                if (!promediosEstudiantes[nota.estudianteId]) {
                    promediosEstudiantes[nota.estudianteId] = [];
                }
                promediosEstudiantes[nota.estudianteId].push(nota.nota);
            });
            const promedios = Object.keys(promediosEstudiantes).map((estudianteId) => {
                const notasEstudiante = promediosEstudiantes[parseInt(estudianteId, 10)];
                const promedio = notasEstudiante.reduce((sum, nota) => sum + nota, 0) / notasEstudiante.length;
                return { estudianteId: parseInt(estudianteId, 10), promedio };
            });
            promedios.sort((a, b) => b.promedio - a.promedio);
            const mejoresPromedios = promedios.slice(0, 3);
            const estudiantesPromedios = await Promise.all(mejoresPromedios.map(async (promedioInfo) => {
                const estudiante = await Prisma_1.prisma.persona.findUnique({
                    where: { id: promedioInfo.estudianteId },
                });
                return {
                    nombreEstudiante: estudiante?.nombre,
                    ApellidosP: estudiante?.apellidoPaterno,
                    ApellidosM: estudiante?.apellidoMaterno,
                    promedio: promedioInfo.promedio,
                };
            }));
            return response.ok(estudiantesPromedios);
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener las notas' });
        }
    }
    async getNotasPRODIO({ response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany();
            const notasConNombres = await Promise.all(notas.map(async (nota) => {
                const estudiante = await Prisma_1.prisma.persona.findUnique({
                    where: { id: nota.estudianteId },
                });
                const libro = await Prisma_1.prisma.libro.findUnique({
                    where: { id: nota.libroId },
                });
                return {
                    ...nota,
                    nombreEstudiante: estudiante?.nombre,
                    ApellidosP: estudiante?.apellidoPaterno,
                    ApellidosM: estudiante?.apellidoMaterno,
                    nombreLibro: libro?.nombre,
                };
            }));
            notasConNombres.sort((a, b) => b.promedioFinal - a.promedioFinal);
            const tresPromediosAltos = notasConNombres.slice(0, 3);
            return response.ok(tresPromediosAltos);
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener las notas' });
        }
    }
    async getNotasReprobadas({ response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany();
            const notasReprobadas = await Promise.all(notas
                .filter(nota => nota.promedioFinal < 71)
                .map(async (nota) => {
                const estudiante = await Prisma_1.prisma.persona.findUnique({
                    where: { id: nota.estudianteId },
                });
                const libro = await Prisma_1.prisma.libro.findUnique({
                    where: { id: nota.libroId },
                });
                return {
                    ...nota,
                    nombreEstudiante: estudiante?.nombre,
                    ApellidosP: estudiante?.apellidoPaterno,
                    ApellidosM: estudiante?.apellidoMaterno,
                    nombreLibro: libro?.nombre,
                };
            }));
            return response.ok(notasReprobadas);
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener las notas reprobadas' });
        }
    }
    async getCantidadReprobados({ response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany();
            const cantidadAprobados = notas.filter(nota => nota.promedioFinal >= 71).length;
            const cantidadReprobados = notas.filter(nota => nota.promedioFinal < 71).length;
            return response.ok({ cantidadAprobados, cantidadReprobados });
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener la cantidad de aprobados y reprobados' });
        }
    }
    async getCantidadReprobadosA({ response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany();
            const cantidadReprobados = notas.filter(nota => nota.promedioFinal < 71).length;
            return response.ok({ cantidadReprobados });
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener la cantidad de reprobados' });
        }
    }
    async getPromediosParaGrafico({ response }) {
        try {
            const notas = await Prisma_1.prisma.nota.findMany();
            const promedios = notas.map(nota => nota.promedioFinal);
            return response.ok({ promedios });
        }
        catch (error) {
            Logger_1.default.error(error);
            return response.badRequest({ message: 'Error al obtener los promedios para el gráfico' });
        }
    }
    async firmas({ response }) {
        const firmas = await Prisma_1.prisma.firma.findMany();
        return response.status(200).json(firmas);
    }
}
exports.default = NotasController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm90YXNDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTm90YXNDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsMkVBQTBEO0FBQzFELHVFQUFrRDtBQUNsRCxzRkFBNEM7QUFJNUMsTUFBcUIsZUFBZTtJQUc3QixLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBdUI7UUFDM0QsSUFBSTtZQUNGLE1BQU0sZ0JBQWdCLEdBQUcsa0JBQU0sQ0FBQyxNQUFNLENBQUM7Z0JBQ3JDLFVBQVUsRUFBRSxrQkFBTSxDQUFDLE1BQU0sRUFBRTtnQkFDM0IsWUFBWSxFQUFFLGtCQUFNLENBQUMsTUFBTSxFQUFFO2dCQUM3QixpQkFBaUIsRUFBRSxrQkFBTSxDQUFDLE1BQU0sRUFBRTtnQkFDbEMsY0FBYyxFQUFFLGtCQUFNLENBQUMsTUFBTSxFQUFFO2dCQUMvQixPQUFPLEVBQUUsa0JBQU0sQ0FBQyxNQUFNLEVBQUU7Z0JBQ3hCLFlBQVksRUFBRSxrQkFBTSxDQUFDLE1BQU0sRUFBRTtnQkFDN0IsT0FBTyxFQUFFLGtCQUFNLENBQUMsTUFBTSxFQUFFO2dCQUN4QixRQUFRLEVBQUUsa0JBQU0sQ0FBQyxNQUFNLEVBQUU7YUFDMUIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDO2dCQUNyQyxNQUFNLEVBQUUsZ0JBQWdCO2FBQ3pCLENBQUMsQ0FBQztZQUdILE1BQU0sWUFBWSxHQUFHLE1BQU0sZUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQy9DLEtBQUssRUFBRTtvQkFDTCxPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87aUJBQ3pCO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsSUFBSSxZQUFZLEVBQUU7Z0JBR2hCLE9BQU8sUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxvQ0FBb0MsRUFBRSxDQUFDLENBQUM7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LEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO1NBQzVDO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxnQkFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVwQixPQUFPLFFBQVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxPQUFPLEVBQUUsNENBQTRDLEVBQUUsQ0FBQyxDQUFDO1NBQ3ZGO0lBQ0gsQ0FBQztJQUlNLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxFQUFFLFFBQVEsRUFBdUI7UUFDcEUsSUFBSTtZQUVGLE1BQU0sS0FBSyxHQUFHLE1BQU0sZUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUczQyxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRXhELE9BQU8sUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7U0FDbkM7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLGdCQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRXBCLE9BQU8sUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxnREFBZ0QsRUFBRSxDQUFDLENBQUM7U0FDM0Y7SUFDSCxDQUFDO0lBRU0sS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRTtRQUU5QixNQUFNLE1BQU0sR0FBRyxNQUFNLGVBQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7UUFFN0MsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUMxQyxDQUFDO0NBVUo7QUFsbEJILGtDQWtsQkciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmcyBmcm9tICdmcydcclxuaW1wb3J0IHR5cGUgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcclxuaW1wb3J0IHsgc2NoZW1hLCBydWxlcyB9IGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvVmFsaWRhdG9yJ1xyXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAaW9jOkFkb25pcy9BZGRvbnMvUHJpc21hJ1xyXG5pbXBvcnQgTG9nZ2VyIGZyb20gJ0Bpb2M6QWRvbmlzL0NvcmUvTG9nZ2VyJ1xyXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCdcclxuaW1wb3J0IEV4Y2VsIGZyb20gJ2V4Y2VsanMnXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOb3Rhc0NvbnRyb2xsZXIge1xyXG5cclxuLy8vLy8vLy8qKioqKioqKioqKiAqL1xyXG5wdWJsaWMgYXN5bmMgc3RvcmUoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHZhbGlkYXRpb25TY2hlbWEgPSBzY2hlbWEuY3JlYXRlKHtcclxuICAgICAgbm90YUV4YW1lbjogc2NoZW1hLm51bWJlcigpLFxyXG4gICAgICBub3RhVHJhYmFqb3M6IHNjaGVtYS5udW1iZXIoKSxcclxuICAgICAgbm90YVBhcnRpY2lwYWNpb246IHNjaGVtYS5udW1iZXIoKSxcclxuICAgICAgbm90YUFzaXN0ZW5jaWE6IHNjaGVtYS5udW1iZXIoKSxcclxuICAgICAgbm90YU9QSTogc2NoZW1hLm51bWJlcigpLFxyXG4gICAgICBlc3R1ZGlhbnRlSWQ6IHNjaGVtYS5zdHJpbmcoKSxcclxuICAgICAgbGlicm9JZDogc2NoZW1hLnN0cmluZygpLFxyXG4gICAgICBmaWxpYWxJZDogc2NoZW1hLnN0cmluZygpLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoe1xyXG4gICAgICBzY2hlbWE6IHZhbGlkYXRpb25TY2hlbWEsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBWZXJpZmljYXIgc2kgeWEgZXhpc3RlIHVuYSBub3RhIHBhcmEgZWwgbGlicm9cclxuICAgIGNvbnN0IGV4aXN0aW5nTm90YSA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRGaXJzdCh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgbGlicm9JZDogcGF5bG9hZC5saWJyb0lkLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGV4aXN0aW5nTm90YSkge1xyXG4gICAgICAvLyBBcXXDrSBwdWVkZXMgbWFuZWphciBsYSBzaXR1YWNpw7NuIGRlIHF1ZSB5YSBleGlzdGUgdW5hIG5vdGEgcGFyYSBlbCBsaWJybyxcclxuICAgICAgLy8geWEgc2VhIGFjdHVhbGl6YW5kbyBlbCByZWdpc3RybyBleGlzdGVudGUgbyBkZXZvbHZpZW5kbyB1biBtZW5zYWplIGRlIGVycm9yLlxyXG4gICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdZYSBleGlzdGUgdW5hIG5vdGEgcGFyYSBlc3RlIGxpYnJvJyB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IG5vdGFUcmFiYWpvc1dlaWdodCA9IDAuNTtcclxuICAgIGNvbnN0IG5vdGFQYXJ0aWNpcGFjaW9uV2VpZ2h0ID0gMC4xO1xyXG4gICAgY29uc3Qgbm90YUFzaXN0ZW5jaWFXZWlnaHQgPSAwLjE7XHJcbiAgICBjb25zdCBub3RhT1BJV2VpZ2h0ID0gMC4zO1xyXG4gICAgXHJcbiAgICBjb25zdCBwcm9tZWRpbyA9IChwYXlsb2FkLm5vdGFUcmFiYWpvcyAqIG5vdGFUcmFiYWpvc1dlaWdodCArXHJcbiAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQubm90YVBhcnRpY2lwYWNpb24gKiBub3RhUGFydGljaXBhY2lvbldlaWdodCArXHJcbiAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQubm90YUFzaXN0ZW5jaWEgKiBub3RhQXNpc3RlbmNpYVdlaWdodCArXHJcbiAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQubm90YU9QSSAqIG5vdGFPUElXZWlnaHQpO1xyXG4gICAgY29uc3QgbnVldmFOb3RhID0gYXdhaXQgcHJpc21hLm5vdGEuY3JlYXRlKHtcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIG5vdGFFeGFtZW46IDAsXHJcbiAgICAgICAgbm90YVRyYWJham9zOiBwYXlsb2FkLm5vdGFUcmFiYWpvcyxcclxuICAgICAgICBub3RhUGFydGljaXBhY2lvbjogcGF5bG9hZC5ub3RhUGFydGljaXBhY2lvbixcclxuICAgICAgICBub3RhQXNpc3RlbmNpYTogcGF5bG9hZC5ub3RhQXNpc3RlbmNpYSxcclxuICAgICAgICBub3RhT1BJOiBwYXlsb2FkLm5vdGFPUEksICAvLyBWYWxvciBudWxvXHJcbiAgICAgICAgbm90YVBhcmNpYWw6IHByb21lZGlvLCAgLy8gVmFsb3IgbnVsb1xyXG4gICAgICAgIG5vdGFSZXRlc3Q6IDAsICAvLyBWYWxvciBudWxvXHJcbiAgICAgICAgcHJvbWVkaW9GaW5hbDogMCwgIC8vIFZhbG9yIG51bG9cclxuICAgICAgICBlc3R1ZGlhbnRlSWQ6IHBheWxvYWQuZXN0dWRpYW50ZUlkLFxyXG4gICAgICAgIGxpYnJvSWQ6IHBheWxvYWQubGlicm9JZCxcclxuICAgICAgICBmaWxpYWxJZDogcGF5bG9hZC5maWxpYWxJZCxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gICAgXHJcblxyXG4gICAgTG9nZ2VyLmluZm8oJ051ZXZhIG5vdGEgY3JlYWRhIGNvbiDDqXhpdG8nLCB7IG5vdGFJZDogbnVldmFOb3RhLmlkIH0pO1xyXG5cclxuICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAxKS5qc29uKG51ZXZhTm90YSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIExvZ2dlci5lcnJvcignRXJyb3IgYWwgY3JlYXIgbGEgbm90YScsIGVycm9yKTtcclxuXHJcbiAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBjcmVhciBsYSBub3RhJyB9KTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4vKnB1YmxpYyBhc3luYyBzdG9yZSh7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdmFsaWRhdGlvblNjaGVtYSA9IHNjaGVtYS5jcmVhdGUoe1xyXG4gICAgICBub3RhRXhhbWVuOiBzY2hlbWEubnVtYmVyKCksXHJcbiAgICAgIG5vdGFUcmFiYWpvczogc2NoZW1hLm51bWJlcigpLFxyXG4gICAgICBub3RhUGFydGljaXBhY2lvbjogc2NoZW1hLm51bWJlcigpLFxyXG4gICAgICBub3RhQXNpc3RlbmNpYTogc2NoZW1hLm51bWJlcigpLFxyXG4gICAgICBub3RhT1BJOiBzY2hlbWEubnVtYmVyKCksXHJcbiAgICAgIG5vdGFQYXJjaWFsOiBzY2hlbWEubnVtYmVyKCksXHJcbiAgICAgIG5vdGFSZXRlc3Q6IHNjaGVtYS5udW1iZXIoKSxcclxuICAgICAgcHJvbWVkaW9GaW5hbDogc2NoZW1hLm51bWJlcigpLFxyXG4gICAgICBlc3R1ZGlhbnRlSWQ6IHNjaGVtYS5zdHJpbmcoKSxcclxuICAgICAgbGlicm9JZDogc2NoZW1hLnN0cmluZygpLFxyXG4gICAgICBmaWxpYWxJZDogc2NoZW1hLnN0cmluZygpLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoe1xyXG4gICAgICBzY2hlbWE6IHZhbGlkYXRpb25TY2hlbWEsXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBWZXJpZmljYXIgc2kgeWEgZXhpc3RlIHVuYSBub3RhIHBhcmEgZWwgbGlicm9cclxuICAgIGNvbnN0IGV4aXN0aW5nTm90YSA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRGaXJzdCh7XHJcbiAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgbGlicm9JZDogcGF5bG9hZC5saWJyb0lkLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGV4aXN0aW5nTm90YSkge1xyXG4gICAgICAvLyBBcXXDrSBwdWVkZXMgbWFuZWphciBsYSBzaXR1YWNpw7NuIGRlIHF1ZSB5YSBleGlzdGUgdW5hIG5vdGEgcGFyYSBlbCBsaWJybyxcclxuICAgICAgLy8geWEgc2VhIGFjdHVhbGl6YW5kbyBlbCByZWdpc3RybyBleGlzdGVudGUgbyBkZXZvbHZpZW5kbyB1biBtZW5zYWplIGRlIGVycm9yLlxyXG4gICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdZYSBleGlzdGUgdW5hIG5vdGEgcGFyYSBlc3RlIGxpYnJvJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBudWV2YU5vdGEgPSBhd2FpdCBwcmlzbWEubm90YS5jcmVhdGUoe1xyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgbm90YUV4YW1lbjogcGF5bG9hZC5ub3RhRXhhbWVuLFxyXG4gICAgICAgIG5vdGFUcmFiYWpvczogcGF5bG9hZC5ub3RhVHJhYmFqb3MsXHJcbiAgICAgICAgbm90YVBhcnRpY2lwYWNpb246IHBheWxvYWQubm90YVBhcnRpY2lwYWNpb24sXHJcbiAgICAgICAgbm90YUFzaXN0ZW5jaWE6IHBheWxvYWQubm90YUFzaXN0ZW5jaWEsXHJcbiAgICAgICAgbm90YU9QSTogcGF5bG9hZC5ub3RhT1BJLFxyXG4gICAgICAgIG5vdGFQYXJjaWFsOiBwYXlsb2FkLm5vdGFQYXJjaWFsLFxyXG4gICAgICAgIG5vdGFSZXRlc3Q6IHBheWxvYWQubm90YVJldGVzdCxcclxuICAgICAgICBwcm9tZWRpb0ZpbmFsOiBwYXlsb2FkLnByb21lZGlvRmluYWwsXHJcbiAgICAgICAgZXN0dWRpYW50ZUlkOiBwYXlsb2FkLmVzdHVkaWFudGVJZCxcclxuICAgICAgICBsaWJyb0lkOiBwYXlsb2FkLmxpYnJvSWQsXHJcbiAgICAgICAgZmlsaWFsSWQ6IHBheWxvYWQuZmlsaWFsSWQsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBMb2dnZXIuaW5mbygnTnVldmEgbm90YSBjcmVhZGEgY29uIMOpeGl0bycsIHsgbm90YUlkOiBudWV2YU5vdGEuaWQgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDEpLmpzb24obnVldmFOb3RhKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgTG9nZ2VyLmVycm9yKCdFcnJvciBhbCBjcmVhciBsYSBub3RhJywgZXJyb3IpO1xyXG5cclxuICAgIHJldHVybiByZXNwb25zZS5iYWRSZXF1ZXN0KHsgbWVzc2FnZTogJ0Vycm9yIGFsIGNyZWFyIGxhIG5vdGEnIH0pO1xyXG4gIH1cclxufSovXHJcblxyXG5wdWJsaWMgIGFzeW5jIG9wdGlvbnMoeyByZXF1ZXN0LCByZXNwb25zZSB9KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVwZGF0ZU5vdGFTY2hlbWEgPSBzY2hlbWEuY3JlYXRlKHtcclxuICAgICAgbm90YUV4YW1lbjogc2NoZW1hLm51bWJlci5vcHRpb25hbCgpLFxyXG4gICAgICBub3RhUGFyY2lhbDogc2NoZW1hLm51bWJlci5vcHRpb25hbCgpLFxyXG4gICAgICBub3RhUmV0ZXN0OiBzY2hlbWEubnVtYmVyLm9wdGlvbmFsKCksXHJcbiAgICAgIG5vdGFJZDogc2NoZW1hLnN0cmluZygpLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gVmFsaWRhciBsYXMgZW50cmFkYXNcclxuICAgIGNvbnN0IHsgbm90YUV4YW1lbiwgbm90YVJldGVzdCwgbm90YUlkIH0gPSBhd2FpdCByZXF1ZXN0LnZhbGlkYXRlKHtcclxuICAgICAgc2NoZW1hOiB1cGRhdGVOb3RhU2NoZW1hLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKG5vdGFFeGFtZW4gPCAwIHx8IG5vdGFSZXRlc3QgPCAwKSB7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5iYWRSZXF1ZXN0KHsgbWVzc2FnZTogJ0xhIG5vdGEgbcOtbmltYSBkZWJlIHNlciAwJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb21lbnphciB1bmEgdHJhbnNhY2Npw7NuXHJcbiAgICBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jIChwcmlzbWEpID0+IHtcclxuICAgICAgLy8gT2J0ZW5lciBsYSBub3RhIGV4aXN0ZW50ZSB1dGlsaXphbmRvIGVsIElEIGRlIGxhIG5vdGFcclxuICAgICAgY29uc3QgZXhpc3RpbmdOb3RhID0gYXdhaXQgcHJpc21hLm5vdGEuZmluZFVuaXF1ZSh7XHJcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG5vdGFJZCB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghZXhpc3RpbmdOb3RhKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmJhZFJlcXVlc3QoeyBtZXNzYWdlOiAnTm8gc2UgZW5jb250csOzIHVuYSBub3RhIGNvbiBlc3RlIElEJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gT2J0ZW5lciBsYSBub3RhUGFyY2lhbCBleGlzdGVudGVcclxuICAgICAgY29uc3Qgbm90YVBhcmNpYWwgPSBleGlzdGluZ05vdGEubm90YVBhcmNpYWw7XHJcblxyXG4gICAgICAvLyBDYWxjdWxhciBlbCBwcm9tZWRpbyBjb25zaWRlcmFuZG8gbG9zIG51ZXZvcyB2YWxvcmVzXHJcbiAgICAgIGxldCBwcm9tZWRpb0ZpbmFsID0gKG5vdGFFeGFtZW4gKiAwLjkpICsgKG5vdGFQYXJjaWFsICogMC4xKTtcclxuXHJcbiAgICAgIC8vIFNpIG5vdGFSZXRlc3QgZXMgbWF5b3IgYSA3NSwgYWN0dWFsaXphIGVsIHByb21lZGlvRmluYWxcclxuICAgICAgaWYgKG5vdGFSZXRlc3QgPiA3NSkge1xyXG4gICAgICAgIHByb21lZGlvRmluYWwgPSBub3RhUmV0ZXN0O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBBY3R1YWxpemFyIGxhIG5vdGEgY29uIGxvcyBudWV2b3MgdmFsb3Jlc1xyXG4gICAgICBjb25zdCBudWV2YU5vdGEgPSBhd2FpdCBwcmlzbWEubm90YS51cGRhdGUoe1xyXG4gICAgICAgIHdoZXJlOiB7IGlkOiBub3RhSWQgfSwgLy8gVXNhbW9zIGVsIElEIGRlIGxhIG5vdGFcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBub3RhRXhhbWVuOiBub3RhRXhhbWVuLFxyXG4gICAgICAgICAgbm90YVJldGVzdDogbm90YVJldGVzdCxcclxuICAgICAgICAgIHByb21lZGlvRmluYWw6IHByb21lZGlvRmluYWwsXHJcbiAgICAgICAgICAvLyBPdHJhcyBwcm9waWVkYWRlcyBzaSBlcyBuZWNlc2FyaW8gICAgICAgICAgICBcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFJlZ2lzdHJhIGVsIMOpeGl0byBlbiBsYSB0cmFuc2FjY2nDs25cclxuICAgICAgTG9nZ2VyLmluZm8oJ1ZhbG9yZXMgYWN0dWFsaXphZG9zIGNvbiDDqXhpdG8nLCB7IG5vdGFJZDogbnVldmFOb3RhLmlkIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiAnVmFsb3JlcyBhY3R1YWxpemFkb3MgY29uIMOpeGl0bycgfSk7XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgLy8gUmVnaXN0cmEgdW4gZXJyb3IgZGV0YWxsYWRvXHJcbiAgICBMb2dnZXIuZXJyb3IoJ0Vycm9yIGFsIGFjdHVhbGl6YXIgbG9zIHZhbG9yZXMnLCBlcnJvcik7XHJcblxyXG4gICAgcmV0dXJuIHJlc3BvbnNlLmJhZFJlcXVlc3QoeyBtZXNzYWdlOiAnRXJyb3IgYWwgYWN0dWFsaXphciBsb3MgdmFsb3JlcycgfSk7XHJcbiAgfVxyXG59IFxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4gIHB1YmxpYyBhc3luYyBzaG93TGlicm8oeyBwYXJhbXMsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG5vdGFzID0gYXdhaXQgcHJpc21hLm5vdGEuZmluZE1hbnkoe1xyXG4gICAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgICBsaWJyb0lkOiBwYXJhbXMuaWQsIC8vIE9idGVuZXIgZWwgSUQgZGVsIGxpYnJvIGRlc2RlIGxvcyBwYXLDoW1ldHJvcyBkZSBsYSBzb2xpY2l0dWRcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgIGVzdHVkaWFudGU6IHRydWUsXHJcbiAgICAgICAgICBsaWJybzogdHJ1ZSxcclxuICAgICAgICAgIGZpbGlhbDogdHJ1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5qc29uKG5vdGFzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIExvZ2dlci5lcnJvcignRXJyb3IgYWwgYnVzY2FyIG5vdGFzIHBvciBJRCBkZSBsaWJybycsIGVycm9yKTtcclxuXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5iYWRSZXF1ZXN0KHsgbWVzc2FnZTogJ0Vycm9yIGFsIGJ1c2NhciBub3RhcyBwb3IgSUQgZGUgbGlicm8nIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBwdWJsaWMgYXN5bmMgc2hvd0ZpbGlhbFMoeyBwYXJhbXMsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG5vdGFzID0gYXdhaXQgcHJpc21hLm5vdGEuZmluZE1hbnkoe1xyXG4gICAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgICBmaWxpYWxJZDogcGFyYW1zLmlkLCAvLyBPYnRlbmVyIGVsIElEIGRlIGxhIGZpbGlhbCBkZXNkZSBsb3MgcGFyw6FtZXRyb3MgZGUgbGEgc29saWNpdHVkXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICBlc3R1ZGlhbnRlOiB0cnVlLFxyXG4gICAgICAgICAgbGlicm86IHRydWUsXHJcbiAgICAgICAgICBmaWxpYWw6IHRydWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMCkuanNvbihub3Rhcyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBMb2dnZXIuZXJyb3IoJ0Vycm9yIGFsIGJ1c2NhciBub3RhcyBwb3IgSUQgZGUgZmlsaWFsIFQnLCBlcnJvcik7XHJcblxyXG4gICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBidXNjYXIgbm90YXMgcG9yIElEIGRlIGZpbGlhbCcgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHB1YmxpYyBhc3luYyBzaG93RmlsaWFsQklFTih7IHBhcmFtcywgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBsaWJyb0lkIH0gPSBwYXJhbXM7XHJcbiAgXHJcbiAgICAgIC8vIEJ1c2NhciB0b2RhcyBsYXMgbm90YXMgcXVlIHRlbmdhbiBlbCBsaWJyb0lkIGVzcGVjaWZpY2Fkb1xyXG4gICAgICBjb25zdCBub3RhcyA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRNYW55KHtcclxuICAgICAgICB3aGVyZTogeyBsaWJyb0lkIH0sXHJcbiAgICAgIH0pO1xyXG4gIFxyXG4gICAgICBpZiAobm90YXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm5vdEZvdW5kKHsgbWVzc2FnZTogJ05vIHNlIGVuY29udHJhcm9uIG5vdGFzIHBhcmEgZXN0ZSBsaWJyb0lkJyB9KTtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzKDIwMCkuanNvbihub3Rhcyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBMb2dnZXIuZXJyb3IoJ0Vycm9yIGFsIGZpbHRyYXIgbGFzIG5vdGFzIHBvciBsaWJyb0lkJywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBmaWx0cmFyIGxhcyBub3RhcyBwb3IgbGlicm9JZCcgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgc2hvd0ZpbGlhbCh7IHBhcmFtcywgcmVzcG9uc2UgfSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZXN0dWRpYW50ZUlkID0gcGFyYW1zLmVzdHVkaWFudGVJZDtcclxuICAgICAgY29uc3QgbGlicm9JZCA9IHBhcmFtcy5saWJyb0lkOyAgLy8gT2J0w6luIGVsIGVzdHVkaWFudGVJZCBkZSBsb3MgcGFyw6FtZXRyb3MgZGUgbGEgc29saWNpdHVkXHJcbiAgXHJcbiAgICAgIC8vIEJ1c2NhciB0b2RhcyBsYXMgbm90YXMgcXVlIGNvaW5jaWRhbiBjb24gZWwgZXN0dWRpYW50ZUlkXHJcbiAgICAgIGNvbnN0IG5vdGFzID0gYXdhaXQgcHJpc21hLm5vdGEuZmluZE1hbnkoe1xyXG4gICAgICAgIHdoZXJlOiB7XHJcbiAgICAgICAgICBlc3R1ZGlhbnRlSWQ6IGVzdHVkaWFudGVJZCxcclxuICAgICAgICAgIGxpYnJvSWQ6IGxpYnJvSWRcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICBcclxuICAgICAgaWYgKG5vdGFzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ05vIHNlIGVuY29udHJhcm9uIG5vdGFzIHBhcmEgZXN0ZSBlc3R1ZGlhbnRlSWQnIH0pO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5qc29uKG5vdGFzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIC8vIFJlZ2lzdHJhIHVuIGVycm9yIGRldGFsbGFkb1xyXG4gICAgICBMb2dnZXIuZXJyb3IoJ0Vycm9yIGFsIGJ1c2NhciBub3RhcyBwb3IgZXN0dWRpYW50ZUlkJywgZXJyb3IpO1xyXG4gIFxyXG4gICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBidXNjYXIgbm90YXMgcG9yIGVzdHVkaWFudGVJZCcgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIFxyXG4gIHB1YmxpYyBhc3luYyBzaG93RXN0dSh7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgbm9tYnJlLCBtYXRyaWN1bGEgfSA9IHJlcXVlc3QucXMoKTtcclxuXHJcbiAgICAgIGlmICghbm9tYnJlICYmICFtYXRyaWN1bGEpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdEZWJlcyBwcm9wb3JjaW9uYXIgYWwgbWVub3MgZWwgbm9tYnJlIG8gbGEgbWF0csOtY3VsYSBkZWwgZXN0dWRpYW50ZS4nIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBub3RhcyA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRNYW55KHtcclxuICAgICAgICB3aGVyZToge1xyXG4gICAgICAgICAgT1I6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIGVzdHVkaWFudGU6IHtcclxuICAgICAgICAgICAgICAgIG5vbWJyZTogbm9tYnJlLFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBlc3R1ZGlhbnRlOiB7XHJcbiAgICAgICAgICAgICAgICBtYXRyaWN1bGE6IG1hdHJpY3VsYSxcclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgXSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICAgIGVzdHVkaWFudGU6IHRydWUsXHJcbiAgICAgICAgICBsaWJybzogdHJ1ZSxcclxuICAgICAgICAgIGZpbGlhbDogdHJ1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMoMjAwKS5qc29uKG5vdGFzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIExvZ2dlci5lcnJvcignRXJyb3IgYWwgYnVzY2FyIG5vdGFzIHBvciBub21icmUgbyBtYXRyw61jdWxhIGRlbCBlc3R1ZGlhbnRlJywgZXJyb3IpO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3BvbnNlLmJhZFJlcXVlc3QoeyBtZXNzYWdlOiAnRXJyb3IgYWwgYnVzY2FyIG5vdGFzIHBvciBub21icmUgbyBtYXRyw61jdWxhIGRlbCBlc3R1ZGlhbnRlJyB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gICAgICBwdWJsaWMgYXN5bmMgZ2V0Tm90YXMoeyByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIC8vIE9idGVuZXIgdG9kYXMgbGFzIG5vdGFzIGRlIGxhIGJhc2UgZGUgZGF0b3NcclxuICAgICAgICAgIGNvbnN0IG5vdGFzID0gYXdhaXQgcHJpc21hLm5vdGEuZmluZE1hbnkoKTtcclxuICAgICAgXHJcbiAgICAgICAgICAvLyBNYXBlYXIgbGFzIG5vdGFzIHBhcmEgYWdyZWdhciBub21icmVzIGRlIGVzdHVkaWFudGUgeSBsaWJyb1xyXG4gICAgICAgICAgY29uc3Qgbm90YXNDb25Ob21icmVzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgICAgICAgIG5vdGFzLm1hcChhc3luYyAobm90YSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGVzdHVkaWFudGUgPSBhd2FpdCBwcmlzbWEucGVyc29uYS5maW5kVW5pcXVlKHtcclxuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBub3RhLmVzdHVkaWFudGVJZCB9LFxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgICAgICAgICBjb25zdCBsaWJybyA9IGF3YWl0IHByaXNtYS5saWJyby5maW5kVW5pcXVlKHtcclxuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBub3RhLmxpYnJvSWQgfSxcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLm5vdGEsXHJcbiAgICAgICAgICAgICAgICBub21icmVFc3R1ZGlhbnRlOiBlc3R1ZGlhbnRlPy5ub21icmUsIC8vIEFqdXN0YSBlbCBjYW1wbyBkZSBub21icmUgc2Vnw7puIHR1IG1vZGVsbyBFc3R1ZGlhbnRlXHJcbiAgICAgICAgICAgICAgICBBcGVsbGlkb3NQOiBlc3R1ZGlhbnRlPy5hcGVsbGlkb1BhdGVybm8sIFxyXG4gICAgICAgICAgICAgICAgQXBlbGxpZG9zTTogZXN0dWRpYW50ZT8uYXBlbGxpZG9NYXRlcm5vLFxyXG5cclxuICAgICAgICAgICAgICAgIG5vbWJyZUxpYnJvOiBsaWJybz8ubm9tYnJlLCAvLyBBanVzdGEgZWwgY2FtcG8gZGUgbm9tYnJlIHNlZ8O6biB0dSBtb2RlbG8gTGlicm9cclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2sobm90YXNDb25Ob21icmVzKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBvYnRlbmVyIGxhcyBub3RhcycgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBwdWJsaWMgYXN5bmMgZ2V0Tm90YXNQb3JMaWJyb0lEKHsgcGFyYW1zLCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IGxpYnJvSWQgPSBwYXJhbXMubGlicm9JZDtcclxuICAgICAgXHJcbiAgICAgICAgICAvLyBPYnRlbmVyIHRvZGFzIGxhcyBub3RhcyBhc29jaWFkYXMgYWwgSUQgZGVsIGxpYnJvXHJcbiAgICAgICAgICBjb25zdCBub3RhcyA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRNYW55KHtcclxuICAgICAgICAgICAgd2hlcmU6IHtcclxuICAgICAgICAgICAgICBsaWJyb0lkOiBsaWJyb0lkLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgLy8gTWFwZWFyIGxhcyBub3RhcyBwYXJhIGFncmVnYXIgbm9tYnJlcyBkZSBlc3R1ZGlhbnRlIHkgbGlicm9cclxuICAgICAgICAgIGNvbnN0IG5vdGFzQ29uTm9tYnJlcyA9IGF3YWl0IFByb21pc2UuYWxsKFxyXG4gICAgICAgICAgICBub3Rhcy5tYXAoYXN5bmMgKG5vdGEpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBlc3R1ZGlhbnRlID0gYXdhaXQgcHJpc21hLnBlcnNvbmEuZmluZFVuaXF1ZSh7XHJcbiAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogbm90YS5lc3R1ZGlhbnRlSWQgfSxcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgICAgICAgICAgY29uc3QgbGlicm8gPSBhd2FpdCBwcmlzbWEubGlicm8uZmluZFVuaXF1ZSh7XHJcbiAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogbm90YS5saWJyb0lkIH0sXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAuLi5ub3RhLFxyXG4gICAgICAgICAgICAgICAgbm9tYnJlRXN0dWRpYW50ZTogZXN0dWRpYW50ZT8ubm9tYnJlLFxyXG4gICAgICAgICAgICAgICAgQXBlbGxpZG9zUDogZXN0dWRpYW50ZT8uYXBlbGxpZG9QYXRlcm5vLFxyXG4gICAgICAgICAgICAgICAgQXBlbGxpZG9zTTogZXN0dWRpYW50ZT8uYXBlbGxpZG9NYXRlcm5vLFxyXG4gICAgICAgICAgICAgICAgbm9tYnJlTGlicm86IGxpYnJvPy5ub21icmUsXHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKG5vdGFzQ29uTm9tYnJlcyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIExvZ2dlci5lcnJvcihlcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmJhZFJlcXVlc3QoeyBtZXNzYWdlOiAnRXJyb3IgYWwgb2J0ZW5lciBsYXMgbm90YXMnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcHVibGljIGFzeW5jIGdldE5vdGFzUCh7IHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgLy8gT2J0ZW5lciB0b2RhcyBsYXMgbm90YXMgZGUgbGEgYmFzZSBkZSBkYXRvc1xyXG4gICAgICAgICAgY29uc3Qgbm90YXMgPSBhd2FpdCBwcmlzbWEubm90YS5maW5kTWFueSgpO1xyXG4gICAgICBcclxuICAgICAgICAgIC8vIENyZWFyIHVuIG9iamV0byBwYXJhIGFsbWFjZW5hciBsb3MgcHJvbWVkaW9zIGRlIGNhZGEgZXN0dWRpYW50ZVxyXG4gICAgICAgICAgY29uc3QgcHJvbWVkaW9zRXN0dWRpYW50ZXM6IHsgW2VzdHVkaWFudGVJZDogbnVtYmVyXTogbnVtYmVyW10gfSA9IHt9O1xyXG4gICAgICBcclxuICAgICAgICAgIC8vIENhbGN1bGFyIGxvcyBwcm9tZWRpb3MgZGUgbm90YXMgcGFyYSBjYWRhIGVzdHVkaWFudGVcclxuICAgICAgICAgIG5vdGFzLmZvckVhY2goKG5vdGEpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFwcm9tZWRpb3NFc3R1ZGlhbnRlc1tub3RhLmVzdHVkaWFudGVJZF0pIHtcclxuICAgICAgICAgICAgICBwcm9tZWRpb3NFc3R1ZGlhbnRlc1tub3RhLmVzdHVkaWFudGVJZF0gPSBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwcm9tZWRpb3NFc3R1ZGlhbnRlc1tub3RhLmVzdHVkaWFudGVJZF0ucHVzaChub3RhLm5vdGEpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgLy8gQ2FsY3VsYXIgbG9zIHByb21lZGlvcyB5IGFzb2NpYXJsb3MgY29uIGxvcyBJRHMgZGUgZXN0dWRpYW50ZXNcclxuICAgICAgICAgIGNvbnN0IHByb21lZGlvcyA9IE9iamVjdC5rZXlzKHByb21lZGlvc0VzdHVkaWFudGVzKS5tYXAoKGVzdHVkaWFudGVJZCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBub3Rhc0VzdHVkaWFudGUgPSBwcm9tZWRpb3NFc3R1ZGlhbnRlc1twYXJzZUludChlc3R1ZGlhbnRlSWQsIDEwKV07XHJcbiAgICAgICAgICAgIGNvbnN0IHByb21lZGlvID1cclxuICAgICAgICAgICAgICBub3Rhc0VzdHVkaWFudGUucmVkdWNlKChzdW0sIG5vdGEpID0+IHN1bSArIG5vdGEsIDApIC8gbm90YXNFc3R1ZGlhbnRlLmxlbmd0aDtcclxuICAgICAgICAgICAgcmV0dXJuIHsgZXN0dWRpYW50ZUlkOiBwYXJzZUludChlc3R1ZGlhbnRlSWQsIDEwKSwgcHJvbWVkaW8gfTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgICAgIC8vIE9yZGVuYXIgbG9zIGVzdHVkaWFudGVzIHNlZ8O6biBzdXMgcHJvbWVkaW9zIGRlIG1heW9yIGEgbWVub3JcclxuICAgICAgICAgIHByb21lZGlvcy5zb3J0KChhLCBiKSA9PiBiLnByb21lZGlvIC0gYS5wcm9tZWRpbyk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgLy8gT2J0ZW5lciBsb3MgdHJlcyBtZWpvcmVzIHByb21lZGlvcyBjb24gbG9zIG5vbWJyZXMgeSBhcGVsbGlkb3MgZGUgbG9zIGVzdHVkaWFudGVzXHJcbiAgICAgICAgICBjb25zdCBtZWpvcmVzUHJvbWVkaW9zID0gcHJvbWVkaW9zLnNsaWNlKDAsIDMpO1xyXG4gICAgICAgICAgY29uc3QgZXN0dWRpYW50ZXNQcm9tZWRpb3MgPSBhd2FpdCBQcm9taXNlLmFsbChcclxuICAgICAgICAgICAgbWVqb3Jlc1Byb21lZGlvcy5tYXAoYXN5bmMgKHByb21lZGlvSW5mbykgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGVzdHVkaWFudGUgPSBhd2FpdCBwcmlzbWEucGVyc29uYS5maW5kVW5pcXVlKHtcclxuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBwcm9tZWRpb0luZm8uZXN0dWRpYW50ZUlkIH0sXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIG5vbWJyZUVzdHVkaWFudGU6IGVzdHVkaWFudGU/Lm5vbWJyZSxcclxuICAgICAgICAgICAgICAgIEFwZWxsaWRvc1A6IGVzdHVkaWFudGU/LmFwZWxsaWRvUGF0ZXJubyxcclxuICAgICAgICAgICAgICAgIEFwZWxsaWRvc006IGVzdHVkaWFudGU/LmFwZWxsaWRvTWF0ZXJubyxcclxuICAgICAgICAgICAgICAgIHByb21lZGlvOiBwcm9tZWRpb0luZm8ucHJvbWVkaW8sXHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKGVzdHVkaWFudGVzUHJvbWVkaW9zKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBvYnRlbmVyIGxhcyBub3RhcycgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLy8vVFJFUyBQUk9NRURJTyBhbHRvIFxyXG4gICAgICBwdWJsaWMgYXN5bmMgZ2V0Tm90YXNQUk9ESU8oeyByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIC8vIE9idGVuZXIgdG9kYXMgbGFzIG5vdGFzIGRlIGxhIGJhc2UgZGUgZGF0b3NcclxuICAgICAgICAgIGNvbnN0IG5vdGFzID0gYXdhaXQgcHJpc21hLm5vdGEuZmluZE1hbnkoKTtcclxuICAgICAgXHJcbiAgICAgICAgICAvLyBNYXBlYXIgbGFzIG5vdGFzIHBhcmEgYWdyZWdhciBub21icmVzIGRlIGVzdHVkaWFudGUgeSBsaWJyb1xyXG4gICAgICAgICAgY29uc3Qgbm90YXNDb25Ob21icmVzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcbiAgICAgICAgICAgIG5vdGFzLm1hcChhc3luYyAobm90YSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGVzdHVkaWFudGUgPSBhd2FpdCBwcmlzbWEucGVyc29uYS5maW5kVW5pcXVlKHtcclxuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBub3RhLmVzdHVkaWFudGVJZCB9LFxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgICAgICAgICBjb25zdCBsaWJybyA9IGF3YWl0IHByaXNtYS5saWJyby5maW5kVW5pcXVlKHtcclxuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBub3RhLmxpYnJvSWQgfSxcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLm5vdGEsXHJcbiAgICAgICAgICAgICAgICBub21icmVFc3R1ZGlhbnRlOiBlc3R1ZGlhbnRlPy5ub21icmUsXHJcbiAgICAgICAgICAgICAgICBBcGVsbGlkb3NQOiBlc3R1ZGlhbnRlPy5hcGVsbGlkb1BhdGVybm8sXHJcbiAgICAgICAgICAgICAgICBBcGVsbGlkb3NNOiBlc3R1ZGlhbnRlPy5hcGVsbGlkb01hdGVybm8sXHJcbiAgICAgICAgICAgICAgICBub21icmVMaWJybzogbGlicm8/Lm5vbWJyZSxcclxuICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgICAgICAvLyBPcmRlbmFyIGxhcyBub3RhcyBwb3IgcHJvbWVkaW9GaW5hbCBkZSBtYW5lcmEgZGVzY2VuZGVudGVcclxuICAgICAgICAgIG5vdGFzQ29uTm9tYnJlcy5zb3J0KChhLCBiKSA9PiBiLnByb21lZGlvRmluYWwgLSBhLnByb21lZGlvRmluYWwpO1xyXG4gICAgICBcclxuICAgICAgICAgIC8vIE9idGVuZXIgbG9zIHRyZXMgcHJvbWVkaW9zIG3DoXMgYWx0b3NcclxuICAgICAgICAgIGNvbnN0IHRyZXNQcm9tZWRpb3NBbHRvcyA9IG5vdGFzQ29uTm9tYnJlcy5zbGljZSgwLCAzKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2sodHJlc1Byb21lZGlvc0FsdG9zKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBvYnRlbmVyIGxhcyBub3RhcycgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vL1RPRE9TIExPUyBSRVBST0JBRE9TIFxyXG4gICAgICBwdWJsaWMgYXN5bmMgZ2V0Tm90YXNSZXByb2JhZGFzKHsgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAvLyBPYnRlbmVyIHRvZGFzIGxhcyBub3RhcyBkZSBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICAgICAgICBjb25zdCBub3RhcyA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRNYW55KCk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgLy8gTWFwZWFyIGxhcyBub3RhcyBwYXJhIGFncmVnYXIgbm9tYnJlcyBkZSBlc3R1ZGlhbnRlIHkgbGlicm9cclxuICAgICAgICAgIGNvbnN0IG5vdGFzUmVwcm9iYWRhcyA9IGF3YWl0IFByb21pc2UuYWxsKFxyXG4gICAgICAgICAgICBub3Rhc1xyXG4gICAgICAgICAgICAgIC5maWx0ZXIobm90YSA9PiBub3RhLnByb21lZGlvRmluYWwgPCA3MSkgLy8gRmlsdHJvIHBhcmEgbm90YXMgcmVwcm9iYWRhcyBjb24gY2FsaWZpY2FjacOzbiBtZW5vciBhIDcxXHJcbiAgICAgICAgICAgICAgLm1hcChhc3luYyAobm90YSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXN0dWRpYW50ZSA9IGF3YWl0IHByaXNtYS5wZXJzb25hLmZpbmRVbmlxdWUoe1xyXG4gICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogbm90YS5lc3R1ZGlhbnRlSWQgfSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxpYnJvID0gYXdhaXQgcHJpc21hLmxpYnJvLmZpbmRVbmlxdWUoe1xyXG4gICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogbm90YS5saWJyb0lkIH0sXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAuLi5ub3RhLFxyXG4gICAgICAgICAgICAgICAgICBub21icmVFc3R1ZGlhbnRlOiBlc3R1ZGlhbnRlPy5ub21icmUsXHJcbiAgICAgICAgICAgICAgICAgIEFwZWxsaWRvc1A6IGVzdHVkaWFudGU/LmFwZWxsaWRvUGF0ZXJubyxcclxuICAgICAgICAgICAgICAgICAgQXBlbGxpZG9zTTogZXN0dWRpYW50ZT8uYXBlbGxpZG9NYXRlcm5vLFxyXG4gICAgICAgICAgICAgICAgICBub21icmVMaWJybzogbGlicm8/Lm5vbWJyZSxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKG5vdGFzUmVwcm9iYWRhcyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIExvZ2dlci5lcnJvcihlcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmJhZFJlcXVlc3QoeyBtZXNzYWdlOiAnRXJyb3IgYWwgb2J0ZW5lciBsYXMgbm90YXMgcmVwcm9iYWRhcycgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vLyBDQU5USURBRCBERSBSRVBST0JBRE9TIFxyXG4gICAgICBwdWJsaWMgYXN5bmMgZ2V0Q2FudGlkYWRSZXByb2JhZG9zKHsgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAvLyBPYnRlbmVyIHRvZGFzIGxhcyBub3RhcyBkZSBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICAgICAgICBjb25zdCBub3RhcyA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRNYW55KCk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgLy8gQ29udGFyIGxhIGNhbnRpZGFkIGRlIG5vdGFzIGFwcm9iYWRhcyAoY29uIGNhbGlmaWNhY2nDs24gbWF5b3IgbyBpZ3VhbCBhIDcxKVxyXG4gICAgICAgICAgY29uc3QgY2FudGlkYWRBcHJvYmFkb3MgPSBub3Rhcy5maWx0ZXIobm90YSA9PiBub3RhLnByb21lZGlvRmluYWwgPj0gNzEpLmxlbmd0aDtcclxuICAgICAgXHJcbiAgICAgICAgICAvLyBDb250YXIgbGEgY2FudGlkYWQgZGUgbm90YXMgcmVwcm9iYWRhcyAoY29uIGNhbGlmaWNhY2nDs24gbWVub3IgYSA3MSlcclxuICAgICAgICAgIGNvbnN0IGNhbnRpZGFkUmVwcm9iYWRvcyA9IG5vdGFzLmZpbHRlcihub3RhID0+IG5vdGEucHJvbWVkaW9GaW5hbCA8IDcxKS5sZW5ndGg7XHJcbiAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLm9rKHsgY2FudGlkYWRBcHJvYmFkb3MsIGNhbnRpZGFkUmVwcm9iYWRvcyB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBvYnRlbmVyIGxhIGNhbnRpZGFkIGRlIGFwcm9iYWRvcyB5IHJlcHJvYmFkb3MnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIHB1YmxpYyBhc3luYyBnZXRDYW50aWRhZFJlcHJvYmFkb3NBKHsgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAvLyBPYnRlbmVyIHRvZGFzIGxhcyBub3RhcyBkZSBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICAgICAgICBjb25zdCBub3RhcyA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRNYW55KCk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgLy8gQ29udGFyIGxhIGNhbnRpZGFkIGRlIG5vdGFzIHJlcHJvYmFkYXMgKGNvbiBjYWxpZmljYWNpw7NuIG1lbm9yIGEgNzEpXHJcbiAgICAgICAgICBjb25zdCBjYW50aWRhZFJlcHJvYmFkb3MgPSBub3Rhcy5maWx0ZXIobm90YSA9PiBub3RhLnByb21lZGlvRmluYWwgPCA3MSkubGVuZ3RoO1xyXG4gICAgICBcclxuICAgICAgICAgIHJldHVybiByZXNwb25zZS5vayh7IGNhbnRpZGFkUmVwcm9iYWRvcyB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYmFkUmVxdWVzdCh7IG1lc3NhZ2U6ICdFcnJvciBhbCBvYnRlbmVyIGxhIGNhbnRpZGFkIGRlIHJlcHJvYmFkb3MnIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuXHJcbiAgICAgIC8vUFJPTUVESU8gRklOQUxFUyBcclxuICAgICAgcHVibGljIGFzeW5jIGdldFByb21lZGlvc1BhcmFHcmFmaWNvKHsgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAvLyBPYnRlbmVyIHRvZGFzIGxhcyBub3RhcyBkZSBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICAgICAgICBjb25zdCBub3RhcyA9IGF3YWl0IHByaXNtYS5ub3RhLmZpbmRNYW55KCk7XHJcbiAgICAgIFxyXG4gICAgICAgICAgLy8gT2J0ZW5lciBsb3MgcHJvbWVkaW9zIGRlIHRvZGFzIGxhcyBub3Rhc1xyXG4gICAgICAgICAgY29uc3QgcHJvbWVkaW9zID0gbm90YXMubWFwKG5vdGEgPT4gbm90YS5wcm9tZWRpb0ZpbmFsKTtcclxuICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2Uub2soeyBwcm9tZWRpb3MgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgIExvZ2dlci5lcnJvcihlcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmJhZFJlcXVlc3QoeyBtZXNzYWdlOiAnRXJyb3IgYWwgb2J0ZW5lciBsb3MgcHJvbWVkaW9zIHBhcmEgZWwgZ3LDoWZpY28nIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcHVibGljIGFzeW5jIGZpcm1hcyh7IHJlc3BvbnNlIH0pIHtcclxuICAgICAgICAvLyBDb25zdWx0YSBwYXJhIG9idGVuZXIgdG9kYXMgbGFzIGZpcm1hc1xyXG4gICAgICAgIGNvbnN0IGZpcm1hcyA9IGF3YWl0IHByaXNtYS5maXJtYS5maW5kTWFueSgpO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1cygyMDApLmpzb24oZmlybWFzKVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIFxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIFxyXG4gICAgICBcclxuICAgICAgXHJcbiAgfVxyXG5cclxuXHJcblxyXG5cclxuXHJcbiBcclxuIFxyXG5cclxuIFxyXG5cclxuIl19